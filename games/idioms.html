<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Idioms Explorer - Gameatica</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/games.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí¨</text></svg>">
    <style>
        .problem-display { text-align: center; padding: 25px 20px; }
        .idiom-box { background: var(--dark); border-radius: 12px; padding: 30px; margin: 20px auto; max-width: 450px; }
        .idiom-box .idiom { font-size: 1.8rem; font-weight: 700; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1.4; }
        .question-text { font-size: 1.1rem; color: var(--gray-light); margin: 20px 0; }
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 10px; max-width: 500px; margin: 0 auto; }
        .option-btn { padding: 14px 18px; background: var(--dark); border: 2px solid rgba(255,255,255,0.1); border-radius: 10px; color: var(--white); font-size: 1rem; cursor: pointer; transition: all 0.2s; text-align: left; }
        .option-btn:hover { border-color: var(--primary); }
        .option-btn.correct { border-color: var(--success); background: rgba(34, 197, 94, 0.2); }
        .option-btn.wrong { border-color: var(--primary); background: rgba(239, 68, 68, 0.2); }
        .feedback { margin-top: 20px; font-size: 1.1rem; min-height: 30px; }
        .feedback.correct { color: var(--success); }
        .feedback.wrong { color: var(--primary); }
        .origin-box { background: rgba(255,255,255,0.03); border-radius: 10px; padding: 15px; margin-top: 15px; font-size: 0.95rem; color: var(--gray-light); max-width: 500px; margin-left: auto; margin-right: auto; display: none; text-align: left; }
        .origin-box.visible { display: block; }
        .origin-box strong { color: var(--white); }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <a href="../index.html" class="back-btn">‚Üê Back</a>
            <h1>üí¨ Idioms Explorer</h1>
        </div>
        
        <div class="score-bar">
            <div class="score-item"><div class="label">Score</div><div class="value" id="score">0</div></div>
            <div class="score-item"><div class="label">Correct</div><div class="value" id="correct">0</div></div>
            <div class="score-item"><div class="label">Streak</div><div class="value" id="streak">0</div></div>
            <div class="score-item"><div class="label">Best</div><div class="value" id="best">0</div></div>
        </div>

        <div class="game-board">
            <div class="problem-display">
                <div class="idiom-box">
                    <div class="idiom" id="idiomDisplay">"Break a leg!"</div>
                </div>
                <div class="question-text">What does this idiom mean?</div>
                <div class="options-grid" id="optionsGrid"></div>
                <div class="feedback" id="feedback"></div>
                <div class="origin-box" id="originBox"></div>
            </div>
        </div>

        <div class="game-controls">
            <button class="btn btn-secondary" id="hintBtn">üí° Hint</button>
            <button class="btn btn-primary" id="nextBtn" style="display:none;">Next ‚Üí</button>
        </div>

        <div class="leaderboard"><h3>üèÜ High Scores</h3><div id="leaderboard"></div></div>
        <div class="instructions">
            <h3>What are Idioms?</h3>
            <ul>
                <li>Idioms are phrases with meanings different from the literal words</li>
                <li>"Raining cats and dogs" doesn't mean animals are falling!</li>
                <li>Learning idioms helps you understand native speakers</li>
            </ul>
        </div>
    </div>

    <script src="../js/cloud-database.js"></script>
    <script src="../js/game-utils.js"></script>
    <script>
        const GAME_ID = 'idioms';
        let score = 0, correctCount = 0, streak = 0, currentIdiom = null, answered = false;
        
        const IDIOMS = [
            { idiom: '"Break a leg!"', meaning: 'Good luck!', wrong: ['Get injured', 'Run away quickly', 'Dance energetically'], hint: 'Used in theaters', origin: 'Theater superstition‚Äîsaying "good luck" was considered bad luck, so actors said the opposite.' },
            { idiom: '"Piece of cake"', meaning: 'Something very easy', wrong: ['A delicious dessert', 'A small portion', 'Something expensive'], hint: 'Think simple, effortless', origin: 'Cakes were given as prizes in competitions, making winning "a piece of cake" an easy reward.' },
            { idiom: '"Cost an arm and a leg"', meaning: 'Very expensive', wrong: ['Cause physical pain', 'Require hard work', 'Take a long time'], hint: 'About price', origin: 'Portrait painters once charged more for including arms and legs in paintings.' },
            { idiom: '"Hit the nail on the head"', meaning: 'To be exactly right', wrong: ['To build something', 'To cause damage', 'To work hard'], hint: 'Perfect accuracy', origin: 'From carpentry‚Äîhitting a nail perfectly requires precision and accuracy.' },
            { idiom: '"Let the cat out of the bag"', meaning: 'To reveal a secret', wrong: ['To release an animal', 'To make a mess', 'To start a fight'], hint: 'About secrets', origin: 'Dishonest merchants would sell cats in bags claiming they were pigs‚Äîopening the bag revealed the trick.' },
            { idiom: '"When pigs fly"', meaning: 'Something that will never happen', wrong: ['A time of celebration', 'Early in the morning', 'During bad weather'], hint: 'Think impossible', origin: 'Since pigs cannot fly, this phrase indicates something is impossible.' },
            { idiom: '"Bite the bullet"', meaning: 'To face something difficult bravely', wrong: ['To eat too fast', 'To make a mistake', 'To get angry'], hint: 'About courage', origin: 'Soldiers would bite bullets during surgery without anesthesia to cope with pain.' },
            { idiom: '"The ball is in your court"', meaning: 'It\'s your turn to make a decision', wrong: ['You\'re playing a sport', 'You\'ve made a mistake', 'You need to exercise'], hint: 'About whose turn it is', origin: 'From tennis‚Äîwhen the ball is on your side, you must make the next move.' },
            { idiom: '"Spill the beans"', meaning: 'To reveal secret information', wrong: ['To make a mess', 'To cook dinner', 'To waste food'], hint: 'About secrets', origin: 'Ancient Greeks voted with beans‚Äîspilling them revealed the vote count early.' },
            { idiom: '"Under the weather"', meaning: 'Feeling sick or unwell', wrong: ['Getting rained on', 'Being outdoors', 'Feeling cold'], hint: 'About health', origin: 'Sailors feeling seasick would go below deck, literally under the weather.' },
            { idiom: '"Burning the midnight oil"', meaning: 'Working late into the night', wrong: ['Wasting resources', 'Starting a fire', 'Being careless'], hint: 'About working hard', origin: 'Before electricity, people used oil lamps‚Äîworking late meant burning oil past midnight.' },
            { idiom: '"Raining cats and dogs"', meaning: 'Raining very heavily', wrong: ['Animals are falling', 'A pet emergency', 'Loud noises outside'], hint: 'About weather', origin: 'In old England, heavy rain washed animals from thatched roofs where they sheltered.' },
            { idiom: '"Kill two birds with one stone"', meaning: 'Accomplish two things at once', wrong: ['Be cruel to animals', 'Make a difficult choice', 'Throw things accurately'], hint: 'About efficiency', origin: 'Ancient hunters valued skill in catching multiple prey with minimal effort.' },
            { idiom: '"Beat around the bush"', meaning: 'Avoid getting to the point', wrong: ['Get lost in nature', 'Search for something', 'Play hide and seek'], hint: 'About indirect speech', origin: 'Hunters would beat bushes to flush out birds rather than going directly for them.' },
            { idiom: '"A penny for your thoughts"', meaning: 'Asking what someone is thinking', wrong: ['Offering money', 'Something very cheap', 'A fair trade'], hint: 'About curiosity', origin: 'A polite way of asking about someone\'s private thoughts, dating to 1500s England.' },
            { idiom: '"Bite off more than you can chew"', meaning: 'Take on more than you can handle', wrong: ['Eat too quickly', 'Be greedy with food', 'Have a big appetite'], hint: 'About overcommitting', origin: 'Taking too much food at once makes it difficult to manage‚Äîlike taking on too many tasks.' },
            { idiom: '"Don\'t cry over spilled milk"', meaning: 'Don\'t worry about past mistakes', wrong: ['Clean up your mess', 'Be careful with drinks', 'Save your food'], hint: 'About letting go', origin: 'Once milk is spilled, you cannot put it back‚Äîso there\'s no point in crying about it.' },
            { idiom: '"The early bird catches the worm"', meaning: 'Success comes to those who act first', wrong: ['Wake up early to eat', 'Birds are hungry', 'Worms appear at dawn'], hint: 'About being proactive', origin: 'Birds that wake earliest have the best chance of finding food before others.' }
        ];
        
        function generateProblem() {
            answered = false;
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('originBox').classList.remove('visible');
            
            currentIdiom = IDIOMS[Math.floor(Math.random() * IDIOMS.length)];
            document.getElementById('idiomDisplay').textContent = currentIdiom.idiom;
            
            const options = [currentIdiom.meaning, ...currentIdiom.wrong].sort(() => Math.random() - 0.5);
            currentIdiom.correctIndex = options.indexOf(currentIdiom.meaning);
            
            document.getElementById('optionsGrid').innerHTML = options.map((opt, i) => 
                `<button class="option-btn" data-index="${i}">${opt}</button>`
            ).join('');
            
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.addEventListener('click', () => checkAnswer(parseInt(btn.dataset.index), btn));
            });
            
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
        }
        
        function checkAnswer(index, btn) {
            if (answered) return;
            answered = true;
            document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
            
            if (index === currentIdiom.correctIndex) {
                btn.classList.add('correct');
                correctCount++; streak++;
                const points = 100 + streak * 20;
                score += points;
                document.getElementById('feedback').textContent = `‚úì Correct! +${points} points`;
                document.getElementById('feedback').className = 'feedback correct';
                GameUtils.playSound('point');
            } else {
                btn.classList.add('wrong');
                document.querySelectorAll('.option-btn')[currentIdiom.correctIndex].classList.add('correct');
                streak = 0;
                document.getElementById('feedback').textContent = '‚úó Incorrect';
                document.getElementById('feedback').className = 'feedback wrong';
                GameUtils.playSound('gameover');
            }
            
            document.getElementById('originBox').innerHTML = `<strong>üìö Origin:</strong> ${currentIdiom.origin}`;
            document.getElementById('originBox').classList.add('visible');
            document.getElementById('nextBtn').style.display = 'inline-flex';
            updateUI();
        }
        
        function showHint() {
            document.getElementById('feedback').textContent = 'üí° Hint: ' + currentIdiom.hint;
        }
        
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('correct').textContent = correctCount;
            document.getElementById('streak').textContent = streak;
            document.getElementById('best').textContent = GameUtils.getPersonalBest(GAME_ID);
        }
        
        document.getElementById('hintBtn').addEventListener('click', showHint);
        document.getElementById('nextBtn').addEventListener('click', generateProblem);
        
        document.getElementById('best').textContent = GameUtils.getPersonalBest(GAME_ID);
        GameUtils.renderLeaderboard(GAME_ID, 'leaderboard');
        generateProblem();
    </script>
</body>
</html>
